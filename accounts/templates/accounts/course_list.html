{% extends 'base.html' %}
{% load static %}

{% block title %}
  Course List
{% endblock %}

{% block content %}
  <!-- Page Header -->
  <div class="row mb-3">
    <div class="col-12">
      <h3 class="m-0">Course List</h3>
    </div>
  </div>

  <!-- Add Course Button -->
  <div class="mb-3">
    <button class="btn btn-primary" onclick="openAddModal()"><i class="fas fa-plus"></i> Add Course</button>
  </div>

  <!-- Card with Table -->

  <div class="card shadow-sm">
    <div class="card-header bg-success text-white">
      <h5 class="mb-0">Available Courses</h5>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table mb-0 data-table fs-10" data-datatables="data-datatables">
          <thead class="bg-primary">
            <tr>
              <th>#</th>
              <th>Course Name</th>
              <th>Short Name</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody class="text-center">
              {% for course in course %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>{{ course.name }}</td>
                  <td>{{ course.short_name }}</td>
                  <td>
                    <div class="dropdown">
                      <button class="btn btn-link text-600 btn-sm dropdown-toggle btn-reveal d-inline-flex align-items-center" type="button" id="dropdownMenuButton{{ course.id }}" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="fas fa-ellipsis-h fs-10"></span></button>
                      <div class="dropdown-menu dropdown-menu-end border py-2" aria-labelledby="dropdownMenuButton{{ course.id }}">
                        <a href="javascript:void(0);" class="dropdown-item" onclick="openEditModal({{ course.id }})"><i class="fas fa-edit me-1"></i> Update</a>
                      </div>
                    </div>
                  </td>
                </tr>
              {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Add Course Modal -->
  <div id="addModal" class="custom-modal">
    <div class="custom-modal-header">
      <button class="close-btn" id="closeAddModalBtn"></button>
      <h5>Add Course</h5>
    </div>
    <div class="custom-modal-body" id="addModalBody">
      <!-- The content will be loaded dynamically here -->
    </div>
  </div>
  <div id="addModalBackdrop" class="custom-modal-backdrop"></div>

  <!-- Edit Course Modal -->
  <div id="editModal" class="custom-modal">
    <div class="custom-modal-header">
      <button class="close-btn" id="closeEditModalBtn"></button>
      <h5>Edit Course</h5>
    </div>
    <div class="custom-modal-body" id="editModalBody">
      <!-- The content will be loaded dynamically here -->
    </div>
  </div>
  <div id="editModalBackdrop" class="custom-modal-backdrop"></div>

  <!-- JavaScript for Modal -->
  <script>
    function openAddModal() {
      const fetchUrl = `/create_course/`
    
      fetch(fetchUrl)
        .then((response) => response.text())
        .then((html) => {
          document.getElementById('addModalBody').innerHTML = html
          document.getElementById('addModal').classList.add('show')
          document.getElementById('addModalBackdrop').classList.add('show')
        })
    }
    
    function openEditModal(courseId) {
      const fetchUrl = `/update_course/${courseId}/`
    
      fetch(fetchUrl)
        .then((response) => response.text())
        .then((html) => {
          document.getElementById('editModalBody').innerHTML = html
          document.getElementById('editModal').classList.add('show')
          document.getElementById('editModalBackdrop').classList.add('show')
        })
    }
    
    // Close button functionality for modals
    document.getElementById('closeAddModalBtn').addEventListener('click', function () {
      document.getElementById('addModal').classList.remove('show')
      document.getElementById('addModalBackdrop').classList.remove('show')
    })
    
    document.getElementById('closeEditModalBtn').addEventListener('click', function () {
      document.getElementById('editModal').classList.remove('show')
      document.getElementById('editModalBackdrop').classList.remove('show')
    })
  </script>
{% endblock %}
