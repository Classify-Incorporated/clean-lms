{% load static %}
<!DOCTYPE html>
<html data-bs-theme="light" lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content="{{ csrf_token }}" />

    <!-- =============================================== -->
    <!-- Document Title -->
    <!-- =============================================== -->
    <title>{{ SCHOOL_NAME }} | Dashboard</title>

    <!-- =============================================== -->
    <!-- Favicons -->
    <!-- =============================================== -->
    <link rel="icon" type="image/png" href="{% static 'favicon.ico' %}" />
    <link rel="manifest" href="{% static 'assets/img/favicons/manifest.json' %}" />
    <meta name="msapplication-TileImage" content="{% static 'assets/img/favicons/mstile-150x150.png' %}" />
    <meta name="theme-color" content="#ffffff" />
    <script src="{% static 'assets/js/config.js' %}"></script>
    <script src="{% static 'vendors/simplebar/simplebar.min.js' %}"></script>

    <!-- =============================================== -->
    <!-- Stylesheets -->
    <!-- =============================================== -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700%7cPoppins:300,400,500,600,700,800,900&amp;display=swap" rel="stylesheet" />
    <link href="{% static 'vendors/simplebar/simplebar.min.css' %}" rel="stylesheet" />
    <link href="{% static 'assets/css/theme-rtl.css' %}" rel="stylesheet" id="style-rtl" />
    <link href="{% static 'assets/css/theme.css' %}" rel="stylesheet" id="style-default" />
    <link href="{% static 'assets/css/user-rtl.css' %}" rel="stylesheet" id="user-style-rtl" />
    <link href="{% static 'assets/css/user.css' %}" rel="stylesheet" id="user-style-default" />
    <link href="{% static 'assets/css/settings.css' %}" rel="stylesheet" id="user-style-default" />
    <link href="{% static 'assets/css/custom_modal.css' %}" rel="stylesheet" id="user-style-default" />

    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" />

    <link href="{% static 'vendors/choices/choices.min.css' %}" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'vendors/select2/select2.min.css' %}" />
    <link rel="stylesheet" href="{% static 'vendors/select2-bootstrap-5-theme/select2-bootstrap-5-theme.min.css' %}" />
    <!-- DataTables Bootstrap 5 CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/3.0.0/css/responsive.bootstrap5.min.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/css/bootstrap-select.min.css" />

    <script src="https://cdn.jsdelivr.net/npm/@joeattardi/emoji-button@4.6.2/dist/index.umd.min.js"></script>

    <script>
      var isRTL = JSON.parse(localStorage.getItem('isRTL'))
      if (isRTL) {
        var linkDefault = document.getElementById('style-default')
        var userLinkDefault = document.getElementById('user-style-default')
        linkDefault.setAttribute('disabled', true)
        userLinkDefault.setAttribute('disabled', true)
        document.querySelector('html').setAttribute('dir', 'rtl')
      } else {
        var linkRTL = document.getElementById('style-rtl')
        var userLinkRTL = document.getElementById('user-style-rtl')
        linkRTL.setAttribute('disabled', true)
        userLinkRTL.setAttribute('disabled', true)
      }
    </script>
  </head>

  <body data-current-user-id="{{ request.user.id }}">
    <main class="main" id="top">
      <div class="container-fluid" data-layout="container">
        <script>
          var isFluid = JSON.parse(localStorage.getItem('isFluid'))
          if (isFluid) {
            var container = document.querySelector('[data-layout="container"]')
            if (container) {
              container.classList.remove('container')
              container.classList.add('container-fluid')
            }
          }
        </script>

        <!-- Sidebar -->
        {% include 'includes/sidebar.html' %}

        <div class="content">
          <!-- Navbar -->
          {% include 'includes/navbar.html' %}

          <!-- Page Content -->
          {% block content %}

          {% endblock %}

          <!-- Footer -->
          <div class="footer">
            {% include 'includes/footer.html' %}
          </div>
        </div>
      </div>
    </main>

    <!-- =============================================== -->
    <!-- JavaScripts -->
    <!-- =============================================== -->
    <script src="{% static 'vendors/popper/popper.min.js' %}"></script>
    <script src="{% static 'vendors/bootstrap/bootstrap.min.js' %}"></script>
    <script src="{% static 'vendors/anchorjs/anchor.min.js' %}"></script>
    <script src="{% static 'vendors/is/is.min.js' %}"></script>
    <script src="{% static 'vendors/echarts/echarts.min.js' %}"></script>
    <script src="{% static 'vendors/fontawesome/all.min.js' %}"></script>
    <script src="{% static 'vendors/lodash/lodash.min.js' %}"></script>
    <script src="{% static 'vendors/list.js/list.min.js' %}"></script>
    <script src="{% static 'assets/js/theme.js' %}"></script>
    <script src="{% static 'vendors/d3/d3.min.js' %}"></script>
    <script src="{% static 'assets/data/world.js' %}"></script>
    <script src="{% static 'vendors/fullcalendar/index.global.min.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="{% static 'vendors/choices/choices.min.js' %}"></script>
    <script src="{% static 'vendors/tinymce/tinymce.min.js' %}"></script>

    <script src="{% static 'vendors/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'vendors/select2/select2.min.js' %}"></script>
    <script src="{% static 'vendors/select2/select2.full.min.js' %}"></script>

    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="{% static 'vendors/datatables.net-fixedcolumns/dataTables.fixedColumns.min.js' %}"></script>

    <!-- DataTables Responsive Extension -->
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/js/bootstrap-select.min.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        tinymce.init({
          selector: 'textarea.tinymce', // Target textarea with class 'tinymce'
          menubar: false,
          plugins: 'lists link image charmap preview',
          toolbar: 'undo redo | bold italic underline | alignleft aligncenter alignright | bullist numlist | link image | preview',
          height: 300,
          branding: false
        })
      
        console.log('TinyMCE Initialized!')
      })
    </script>
    <script>
      $(document).ready(function () {
        var tableElement = $('table[data-datatables="data-datatables"]')
      
        if ($.fn.DataTable.isDataTable(tableElement)) {
          tableElement.DataTable().destroy() // Destroy existing instance
        }
      
        tableElement.DataTable({
          responsive: true, // âœ… Enables mobile-friendly layout
          autoWidth: false,
          paging: true,
          searching: true,
          ordering: true,
          pageLength: 10
        })
      })
    </script>

    <script>
      function displayToast(message, icon) {
        Swal.fire({
          toast: true,
          position: 'top-end',
          icon: icon,
          title: message,
          showConfirmButton: false,
          timer: 5000,
          timerProgressBar: true,
        });
      }

      // Check for form errors and display them with error icon
      {% if form.errors %}
        {% for field in form %}
          {% for error in field.errors %}
            displayToast("{{ error }}", 'error');  // Display form errors with 'error' icon
          {% endfor %}
        {% endfor %}
      {% endif %}

      // Check for Django messages and handle their type
      {% if messages %}
        {% for message in messages %}
          {% if message.tags == 'error' %}
            displayToast("{{ message }}", 'error');  // Display error messages
          {% else %}
            displayToast("{{ message }}", 'success');  // Display success or other messages
          {% endif %}
        {% endfor %}
      {% endif %}
    </script>
    <script>
      $(document).ready(function() {
        $('.select2').select2({
          theme: 'bootstrap-5',
          placeholder: function() {
            $(this).data('placeholder');
          },
          allowClear: true
        });
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        let currentUrl = window.location.pathname; // Get current page path
      
        document.querySelectorAll(".nav-link").forEach(link => {
          if (link.getAttribute("href") === currentUrl) {
            link.classList.add("active");
          }
      
          // Handle dropdown menus
          let parentMenu = link.closest(".nav.collapse");
          if (link.classList.contains("active") && parentMenu) {
            parentMenu.classList.add("show"); // Expand parent menu
            let parentTrigger = document.querySelector(`[href="#${parentMenu.id}"]`);
            if (parentTrigger) {
              parentTrigger.classList.add("active"); // Highlight parent menu link
            }
          }
        });
      });
      
     </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        let currentUrl = window.location.pathname; // Get current page path
    
        document.querySelectorAll(".nav-link").forEach(link => {
          if (link.getAttribute("href") === currentUrl) {
            link.classList.add("active");
          }
    
          // Handle dropdown menus
          let parentMenu = link.closest(".nav.collapse");
          if (link.classList.contains("active") && parentMenu) {
            parentMenu.classList.add("show"); // Expand parent menu
            let parentTrigger = document.querySelector(`[href="#${parentMenu.id}"]`);
            if (parentTrigger) {
              parentTrigger.classList.add("active"); // Highlight parent menu link
            }
          }
        });
    
        // Close other dropdowns when opening a new one
        document.querySelectorAll(".nav-link.dropdown-indicator").forEach(trigger => {
          trigger.addEventListener("click", function (event) {
            let targetId = this.getAttribute("href").substring(1);
            let targetMenu = document.getElementById(targetId);
    
            if (!targetMenu.classList.contains("show")) {
              // Close other dropdowns
              document.querySelectorAll(".nav.collapse.show").forEach(openMenu => {
                if (openMenu !== targetMenu) {
                  openMenu.classList.remove("show");
                  let openTrigger = document.querySelector(`[href="#${openMenu.id}"]`);
                  if (openTrigger) {
                    openTrigger.classList.remove("active");
                  }
                }
              });
            }
          });
        });
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".unread-log").forEach(function (log) {
            log.addEventListener("click", function (event) {
                event.preventDefault();
                let logElement = this;
    
                // Extract subject_log_id from the clicked notification
                let subjectLogId = logElement.dataset.logId; 
    
                fetch(`/mark-notification-read/${subjectLogId}/`, {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": getCSRFToken(),
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ subject_log_id: subjectLogId }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === "success") {
                        logElement.classList.remove("unread-log");
                        logElement.classList.add("read-log");
    
                        // Update notification count dynamically
                        let notificationCounter = document.querySelector(".notification-indicator-number");
                        let count = parseInt(notificationCounter.innerText) || 0;
                        if (count > 0) {
                            notificationCounter.innerText = count - 1;
                        }
                        if (count - 1 === 0) {
                            notificationCounter.style.display = "none"; 
                        }
                    }
                })
                .catch(error => console.error("Error marking as read:", error));
            });
        });
    
        function getCSRFToken() {
            let csrfTokenMeta = document.querySelector('meta[name="csrf-token"]');
            return csrfTokenMeta ? csrfTokenMeta.getAttribute("content") : "";
        }
    });    
  </script>
    <script src="{% static 'js/classroom-mode.js' %}"></script>
    {% comment %} <script src="{% static 'js/deactivate-classroom-mode.js' %}"></script> {% endcomment %}
  </body>
</html>
